#:kivy 2.3.0

# ==========================================================
#                 CLASS DEFINITIONS (TOP LEVEL)
# ==========================================================

# --------------------------
# SPLIT SCREEN UI DEFINITION
# --------------------------
<SplitScreen>:
    name: "split"

    BoxLayout:
        orientation: "vertical"
        spacing: 10
        padding: 10

        Label:
            text: "üìÑ Select a PDF and enter split page number"
            size_hint_y: None
            height: 40
            color: (0.2, 0.2, 0.2, 1)

        ScrollView:
            GridLayout:
                id: split_grid
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                row_default_height: 40
                spacing: 10

        Button:
            text: "Process Split"
            size_hint_y: None
            height: 50
            background_color: (0.2, 0.5, 1, 1)
            color: (1, 1, 1, 1)
            on_press: root.process_split()


# --------------------------
# MERGE SCREEN UI DEFINITION
# --------------------------
<MergeScreen>:
    name: "merge"

    BoxLayout:
        orientation: "vertical"
        spacing: dp(10)
        padding: dp(10)

        Label:
            text: "üìé Merge multiple PDFs"
            size_hint_y: None
            height: dp(40)
            color: (0.1, 0.1, 0.1, 1)

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            GridLayout:
                id: merge_list
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(6)

                # Placeholder sample item (temporary)
                BoxLayout:
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(10)
                    padding: dp(5)
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [8]

                    Image:
                        source: "assets/icons/pdf_icon.png"
                        size_hint_x: None
                        width: dp(30)

                    Label:
                        text: "sample1.pdf (5 pages)"
                        halign: "left"
                        valign: "middle"

                    Button:
                        text: "‚ò∞"
                        size_hint_x: None
                        width: dp(40)
                        background_normal: ""
                        background_color: 0, 0, 0, 0

                    Button:
                        text: "‚ùå"
                        size_hint_x: None
                        width: dp(40)
                        background_normal: ""
                        background_color: 1, 0, 0, 0.2

        Button:
            id: merge_btn
            text: "Merge PDFs"
            size_hint_y: None
            height: dp(50)
            background_color: 0.3, 0.5, 0.9, 1
            disabled: True


# --------------------------
# NAV ICON UI DEFINITION
# --------------------------
<NavIcon@ButtonBehavior+BoxLayout>:
    source: ""
    text: ""
    on_press: None
    orientation: "vertical"
    padding: 5
    spacing: 2

    Image:
        id: icon_img
        source: root.source
        allow_stretch: True
        keep_ratio: True
        size_hint_y: 0.8

    Label:
        text: root.text if not icon_img.texture else ""
        color: (0.1, 0.1, 0.1, 1)
        font_size: 12
        halign: "center"
        valign: "middle"


# ==========================================================
#                 HOME SCREEN (NEW)
# ==========================================================
<RoundedAccentButton@Button>:
    background_normal: ""
    background_down: ""
    background_color: 0, 0, 0, 0
    color: 1, 1, 1, 1
    font_size: "16sp"
    size_hint_y: None
    height: dp(48)
    canvas.before:
        Color:
            rgba: (0.23, 0.56, 0.88, 1) if self.state == "normal" else (0.18, 0.49, 0.82, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12, 12, 12, 12]


<HomeScreen>:
    name: "home"

    BoxLayout:
        orientation: "vertical"
        spacing: dp(12)
        padding: dp(16)
        canvas.before:
            Color:
                rgba: 0.97, 0.97, 0.97, 1
            Rectangle:
                pos: self.pos
                size: self.size

        # ----- Top Branding -----
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            spacing: dp(12)

            Image:
                source: "assets/icons/app_logo.png"
                size_hint_x: None
                width: dp(48)
                allow_stretch: True
                keep_ratio: True

            BoxLayout:
                orientation: "vertical"
                spacing: dp(2)

                Label:
                    text: "PDFHub"
                    bold: True
                    color: 0.12, 0.12, 0.12, 1
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                    font_size: "20sp"

                Label:
                    text: "Manage your PDFs easily  ‚Ä¢  Developed by Nazmul Hasan"
                    color: 0.35, 0.35, 0.35, 1
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                    font_size: "13sp"

        Widget:
            size_hint_y: None
            height: dp(1)
            canvas:
                Color:
                    rgba: 0, 0, 0, 0.06
                Rectangle:
                    pos: self.pos
                    size: self.size

        # ----- Middle (Recent Files Placeholder) -----
        BoxLayout:
            id: recent_container
            orientation: "vertical"
            padding: dp(4)
            Label:
                id: recent_empty_label
                text: "Home ‚Äì Recently opened PDFs\\n\\nNo recent PDFs. Open one to get started."
                color: 0.25, 0.25, 0.25, 1
                halign: "center"
                valign: "middle"
                text_size: self.size
                font_size: "16sp"

        # ----- Bottom Quick Access -----
        BoxLayout:
            size_hint_y: None
            height: dp(64)
            spacing: dp(12)

            RoundedAccentButton:
                id: btn_open_pdf_file
                text: "üìÇ  Open PDF File"
                # on_release: app.on_open_pdf_file()   # (to wire in Step 2)

            RoundedAccentButton:
                id: btn_open_pdfhub_folder
                text: "üìÅ  Open PDFHub Folder"
                # on_release: app.on_open_pdfhub_folder()   # (to wire in Step 2)


# ==========================================================
#                 MAIN APP LAYOUT (ROOT)
# ==========================================================
<PDFhubRoot>:
    orientation: "vertical"
    padding: 10
    spacing: 5

    canvas.before:
        Color:
            rgba: 0.97, 0.97, 0.97, 1
        Rectangle:
            pos: self.pos
            size: self.size

    # --- Search Bar (Top) ---
    BoxLayout:
        size_hint_y: 0.08
        spacing: 10
        canvas.before:
            Color:
                rgba: 0.94, 0.94, 0.94, 1
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [8]

        TextInput:
            hint_text: "Search PDFs..."
            background_color: (0, 0, 0, 0)
            foreground_color: (0.2, 0.2, 0.2, 1)
            font_size: 16
            padding: 15, 10

    # --- Screen Manager (Main Tabs) ---
    ScreenManager:
        id: screen_manager

        HomeScreen:
            name: "home"

        EditScreen:
            name: "edit"
            BoxLayout:
                orientation: "vertical"
                Label:
                    text: "‚úèÔ∏è Edit PDFs / Add Signatures"
                    color: (0.1, 0.1, 0.1, 1)
                    font_size: 20

        SplitScreen:
            name: "split"

        MergeScreen:
            name: "merge"

        SettingsScreen:
            name: "settings"
            BoxLayout:
                orientation: "vertical"
                Label:
                    text: "‚öôÔ∏è App Settings"
                    color: (0.1, 0.1, 0.1, 1)
                    font_size: 20

    # --- Bottom Navigation Bar ---
    BoxLayout:
        size_hint_y: 0.1
        spacing: 25
        padding: [40, 5]
        canvas.before:
            Color:
                rgba: 0.92, 0.95, 0.98, 1
            Rectangle:
                pos: self.pos
                size: self.size

        NavIcon:
            source: "assets/icons/home.png"
            text: "Home"
            on_press: root.switch_tab("home")

        NavIcon:
            source: "assets/icons/edit.png"
            text: "Edit"
            on_press: root.switch_tab("edit")

        NavIcon:
            source: "assets/icons/split.png"
            text: "Split"
            on_press: root.switch_tab("split")

        NavIcon:
            source: "assets/icons/merge.png"
            text: "Merge"
            on_press: root.switch_tab("merge")

        NavIcon:
            source: "assets/icons/settings.png"
            text: "Settings"
            on_press: root.switch_tab("settings")
